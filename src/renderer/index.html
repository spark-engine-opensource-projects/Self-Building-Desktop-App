<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self' https://api.anthropic.com; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'; worker-src 'none'; manifest-src 'self'; media-src 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="no-referrer">
    <title>AI Dynamic Application Builder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
                    <svg id="sunIcon" viewBox="0 0 24 24">
                        <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/>
                    </svg>
                    <svg id="moonIcon" viewBox="0 0 24 24" style="display: none;">
                        <path d="M17.75 4.09L15.22 6.03L16.13 9.09L13.5 7.28L10.87 9.09L11.78 6.03L9.25 4.09L12.44 4L13.5 1L14.56 4L17.75 4.09M21.25 11L19.61 12.25L20.2 14.23L18.5 13.06L16.8 14.23L17.39 12.25L15.75 11L17.81 10.95L18.5 9L19.19 10.95L21.25 11M18.97 15.95C19.8 15.87 20.69 17.05 20.16 17.8C19.84 18.25 19.5 18.67 19.08 19.07C15.17 23 8.84 23 4.94 19.07C1.03 15.17 1.03 8.83 4.94 4.93C5.34 4.53 5.76 4.17 6.21 3.85C6.96 3.32 8.14 4.21 8.06 5.04C7.79 7.9 8.75 10.87 10.95 13.06C13.14 15.26 16.1 16.22 18.97 15.95Z"/>
                    </svg>
                </button>
                <button id="toggleDatabaseBtn" class="nav-btn">üóÑÔ∏è Database</button>
                <button id="performanceDashboardBtn" class="nav-btn">üìä Performance</button>
            </div>
            <h1>ü§ñ AI Dynamic Application Builder</h1>
            <p>Powered by Claude - Generate and execute code from natural language</p>
        </header>

        <!-- API Key Configuration -->
        <section class="api-config" id="apiConfig">
            <div class="config-header">
                <h2>üîë Anthropic API Configuration</h2>
                <span class="status" id="apiStatus">Not Configured</span>
            </div>
            <div class="config-content">
                <div class="input-group">
                    <input type="password" id="apiKeyInput" placeholder="Enter your Anthropic API key">
                    <button id="setApiKeyBtn" class="btn btn-primary">Set API Key</button>
                    <button id="loadApiKeyBtn" class="btn btn-secondary">Load from File</button>
                </div>
                <p class="help-text">
                    Get your API key from <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a>
                </p>
            </div>
        </section>

        <!-- Live Database Preview Sidebar -->
        <aside id="dbContextSidebar" class="db-context-sidebar" style="display: none;">
            <div class="sidebar-header">
                <h3>üìä Database Context</h3>
                <button id="closeSidebar" class="close-btn">‚úï</button>
            </div>
            <div class="sidebar-content">
                <div class="db-info">
                    <strong>Current Database:</strong>
                    <span id="currentDbName">None</span>
                </div>
                <div class="tables-preview">
                    <h4>Available Tables:</h4>
                    <div id="tablesPreviewList">
                        <p class="no-data">No tables yet. Create one in your code!</p>
                    </div>
                </div>
                <button id="refreshDbContext" class="btn btn-sm" style="width: 100%; margin-top: 10px;">
                    üîÑ Refresh
                </button>
            </div>
        </aside>

        <!-- Toggle DB Context Button -->
        <button id="toggleDbContext" class="floating-btn" title="Show Database Context">
            üóÑÔ∏è
        </button>

        <!-- Code Generation -->
        <section class="code-generation" id="codeGeneration" style="display: none;">
            <h2>üí° Describe Your Application</h2>

            <!-- Quick Start Templates -->
            <div class="quick-templates" style="margin-bottom: 15px;">
                <h3 style="font-size: 14px; margin-bottom: 8px; color: #64748b;">‚ö° Quick Start Templates:</h3>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="template-btn" data-template="todo">üìù Todo List</button>
                    <button class="template-btn" data-template="notes">üìî Note Taking</button>
                    <button class="template-btn" data-template="contacts">üë• Contacts</button>
                    <button class="template-btn" data-template="expenses">üí∞ Expense Tracker</button>
                    <button class="template-btn" data-template="inventory">üì¶ Inventory</button>
                    <button class="template-btn" data-template="diary">üìñ Diary/Journal</button>
                </div>
            </div>

            <div class="input-group">
                <textarea id="promptInput" placeholder="Describe what you want to build...

Examples:
‚Ä¢ Create a todo list app with add, complete, and delete functionality
‚Ä¢ Build a note-taking app with categories and search
‚Ä¢ Make a contact manager with phone and email fields
‚Ä¢ Create an expense tracker with charts and categories"></textarea>
                <button id="generateBtn" class="btn btn-primary">
                    <span class="btn-text">Generate Code</span>
                    <div class="spinner" style="display: none;"></div>
                </button>
            </div>
        </section>

        <!-- Generated Code Display -->
        <section class="code-display" id="codeDisplay" style="display: none;">
            <div class="code-header">
                <h2>üìã Generated Code</h2>
                <div class="code-actions">
                    <button id="executeBtn" class="btn btn-success">‚ñ∂Ô∏è Execute</button>
                    <button id="clearBtn" class="btn btn-secondary">üóëÔ∏è Clear</button>
                </div>
            </div>
            
            <div class="code-info">
                <div class="info-item">
                    <strong>Description:</strong>
                    <span id="codeDescription">-</span>
                </div>
                <div class="info-item">
                    <strong>Packages:</strong>
                    <span id="codePackages">None</span>
                </div>
            </div>

            <div class="code-container">
                <pre><code id="generatedCode"></code></pre>
            </div>
        </section>

        <!-- Execution Results -->
        <section class="execution-results" id="executionResults" style="display: none;">
            <h2>üöÄ Execution Results</h2>
            <div class="results-container">
                <div class="output-section">
                    <h3>Output</h3>
                    <pre id="executionOutput" class="output-content"></pre>
                </div>
                <div class="error-section" id="errorSection" style="display: none;">
                    <h3>Errors/Warnings</h3>
                    <pre id="executionErrors" class="error-content"></pre>
                </div>
            </div>
            <!-- Execution root for generated content -->
            <div id="execution-root" style="margin-top: 20px; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 8px; background: #f8fafc;">
                <!-- Generated UI components will appear here -->
            </div>
        </section>

        <!-- Database Management -->
        <section class="database-section" id="databaseSection" style="display: none;">
            <div class="section-header">
                <h2>üóÑÔ∏è Database Management</h2>
                <div class="section-actions">
                    <button id="showDbManagerBtn" class="btn btn-primary">Database Manager</button>
                    <button id="showSchemaGeneratorBtn" class="btn btn-secondary">AI Schema Generator</button>
                    <button id="showVisualDesignerBtn" class="btn btn-secondary">Visual Designer</button>
                </div>
            </div>

            <!-- Visual Schema Designer -->
            <div id="visualSchemaDesigner" class="subsection" style="display: none;">
                <h3>üé® Visual Schema Designer</h3>
                <div class="designer-container">
                    <div class="designer-form">
                        <div class="form-group">
                            <label>Table Name:</label>
                            <input type="text" id="designerTableName" placeholder="e.g., users, products, orders">
                        </div>

                        <div class="columns-designer">
                            <h4>Columns:</h4>
                            <div id="columnsContainer"></div>
                            <button id="addColumnBtn" class="btn btn-outline" style="width: 100%; margin-top: 10px;">
                                ‚ûï Add Column
                            </button>
                        </div>

                        <div class="designer-actions" style="margin-top: 20px;">
                            <button id="generateSchemaCodeBtn" class="btn btn-primary">
                                Generate Table Code
                            </button>
                            <button id="createTableFromDesignBtn" class="btn btn-success">
                                Create Table Now
                            </button>
                            <button id="clearDesignerBtn" class="btn btn-outline">
                                Clear
                            </button>
                        </div>
                    </div>

                    <div class="designer-preview">
                        <h4>Preview:</h4>
                        <div id="schemaPreview" class="schema-preview-box">
                            <p class="no-data">Add columns to see preview</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Database Manager -->
            <div id="databaseManager" class="subsection" style="display: none;">
                <div class="database-controls">
                    <div class="control-group">
                        <label for="databaseSelect">Database:</label>
                        <select id="databaseSelect">
                            <option value="">Select database...</option>
                        </select>
                        <input type="text" id="newDatabaseName" placeholder="New database name">
                        <button id="createDatabaseBtn" class="btn btn-outline">Create DB</button>
                        <button id="refreshDatabasesBtn" class="btn btn-outline">Refresh</button>
                    </div>
                </div>

                <div class="database-content">
                    <!-- Tables List -->
                    <div class="tables-panel">
                        <h3>Tables</h3>
                        <div class="tables-list" id="tablesList">
                            <p class="no-data">Select a database to view tables</p>
                        </div>
                        <div class="table-actions">
                            <button id="createTableBtn" class="btn btn-primary" disabled>Create Table</button>
                            <button id="exportDatabaseBtn" class="btn btn-secondary" disabled>Export Database</button>
                        </div>
                    </div>

                    <!-- Data Panel -->
                    <div class="data-panel" id="dataPanel" style="display: none;">
                        <div class="data-header">
                            <h3 id="currentTableName">Table Data</h3>
                            <div class="data-actions">
                                <button id="addRecordBtn" class="btn btn-success">Add Record</button>
                                <button id="refreshDataBtn" class="btn btn-outline">Refresh</button>
                                <button id="queryBuilderBtn" class="btn btn-secondary">Query Builder</button>
                            </div>
                        </div>
                        <div class="data-content">
                            <div id="dataTable" class="data-table-container"></div>
                            <div id="dataPagination" class="pagination"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Schema Generator -->
            <div id="schemaGenerator" class="subsection" style="display: none;">
                <div class="schema-input">
                    <h3>AI Schema Generator</h3>
                    <textarea id="schemaDescription" placeholder="Describe your database needs...

Examples:
‚Ä¢ A blog system with users, posts, and comments
‚Ä¢ An inventory management system for a retail store  
‚Ä¢ A project management tool with teams, projects, and tasks
‚Ä¢ A customer relationship management system"></textarea>
                    <div class="schema-actions">
                        <button id="generateSchemaBtn" class="btn btn-primary">
                            <span class="btn-text">Generate Schema</span>
                            <div class="spinner" style="display: none;"></div>
                        </button>
                        <button id="generateScriptBtn" class="btn btn-secondary">Generate Full Script</button>
                    </div>
                </div>

                <div id="schemaOutput" class="schema-output" style="display: none;">
                    <div class="schema-tabs">
                        <button class="tab-btn active" data-tab="visual">Visual</button>
                        <button class="tab-btn" data-tab="json">JSON Schema</button>
                        <button class="tab-btn" data-tab="sql">SQL Script</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="visualSchema" class="tab-pane active">
                            <div id="schemaVisualization"></div>
                        </div>
                        <div id="jsonSchema" class="tab-pane">
                            <pre><code id="schemaJson"></code></pre>
                        </div>
                        <div id="sqlScript" class="tab-pane">
                            <pre><code id="schemaSql"></code></pre>
                        </div>
                    </div>
                    
                    <div class="schema-implementation">
                        <button id="implementSchemaBtn" class="btn btn-success">Implement Schema</button>
                        <button id="suggestImprovementsBtn" class="btn btn-outline">Suggest Improvements</button>
                    </div>
                </div>
            </div>

            <!-- Query Builder -->
            <div id="queryBuilder" class="subsection" style="display: none;">
                <div class="query-header">
                    <h3>Visual Query Builder</h3>
                    <button id="closeQueryBuilderBtn" class="btn btn-outline">Close</button>
                </div>
                
                <div class="query-controls">
                    <div class="query-type">
                        <label>Query Type:</label>
                        <select id="queryType">
                            <option value="SELECT">SELECT</option>
                            <option value="INSERT">INSERT</option>
                            <option value="UPDATE">UPDATE</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                    </div>
                    
                    <div class="query-conditions" id="queryConditions">
                        <div class="condition-row">
                            <select class="condition-column"></select>
                            <select class="condition-operator">
                                <option value="=">=</option>
                                <option value="!=">!=</option>
                                <option value=">">></option>
                                <option value="<"><</option>
                                <option value=">=">>=</option>
                                <option value="<="><=</option>
                                <option value="LIKE">LIKE</option>
                                <option value="IN">IN</option>
                            </select>
                            <input type="text" class="condition-value" placeholder="Value">
                            <button class="remove-condition btn btn-sm">√ó</button>
                        </div>
                    </div>
                    
                    <button id="addConditionBtn" class="btn btn-outline">Add Condition</button>
                    <button id="executeQueryBtn" class="btn btn-primary">Execute Query</button>
                </div>
                
                <div class="query-preview">
                    <h4>Generated SQL:</h4>
                    <pre id="generatedSQL"></pre>
                </div>
            </div>

            <!-- Data Form Modal -->
            <div id="dataFormModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="formTitle">Add Record</h3>
                        <button id="closeFormBtn" class="modal-close">√ó</button>
                    </div>
                    <form id="dataForm">
                        <div id="formFields"></div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" id="cancelFormBtn" class="btn btn-outline">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Session Info -->
        <footer class="session-info">
            <span>Session: <code id="sessionId">Not started</code></span>
            <button id="newSessionBtn" class="btn btn-outline">New Session</button>
        </footer>
    </div>

    <script src="../utils/rendererLogger.js"></script>
    <script src="../utils/performanceUtils.js"></script>
    <script src="../utils/errorBoundary.js"></script>
    <script src="../utils/secureDOMExecutor.js"></script>
    <script src="../utils/dataVisualizer.js"></script>
    <script src="domHelpers.js"></script>
    <script src="renderer.js"></script>
</body>
</html>