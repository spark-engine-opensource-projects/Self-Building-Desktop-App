<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self';">
    <title>Performance Dashboard - AI Dynamic Application Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
            overflow-x: auto;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: 600;
            color: #1a202c;
        }

        .dashboard-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-healthy { background: #48bb78; }
        .status-warning { background: #ed8936; }
        .status-critical { background: #f56565; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .card-subtitle {
            font-size: 12px;
            color: #718096;
            margin-top: 2px;
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 5px;
        }

        .metric-unit {
            font-size: 14px;
            color: #718096;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-low { background: #48bb78; }
        .progress-medium { background: #ed8936; }
        .progress-high { background: #f56565; }

        .chart-container {
            grid-column: 1 / -1;
            height: 300px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .alerts-container {
            grid-column: 1 / -1;
        }

        .alert-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fef5e7;
            border-left-color: #ed8936;
        }

        .alert-error {
            background: #fed7d7;
            border-left-color: #f56565;
        }

        .alert-info {
            background: #e6fffa;
            border-left-color: #38b2ac;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .alert-message {
            font-size: 14px;
            color: #718096;
        }

        .alert-time {
            font-size: 12px;
            color: #a0aec0;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #4299e1;
        }

        .recommendation-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recommendation-text {
            font-size: 14px;
            color: #718096;
        }

        .priority-high { border-left-color: #f56565; }
        .priority-medium { border-left-color: #ed8936; }
        .priority-low { border-left-color: #48bb78; }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            font-size: 16px;
            color: #718096;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .refresh-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .auto-refresh input[type="checkbox"] {
            margin: 0;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">Performance Dashboard</h1>
                <div class="dashboard-subtitle">Real-time system monitoring and analytics</div>
            </div>
            <div class="dashboard-status">
                <div class="refresh-controls">
                    <button id="refreshBtn" class="btn btn-secondary">ðŸ”„ Refresh</button>
                    <button id="exportBtn" class="btn btn-secondary">ðŸ“Š Export</button>
                    <div class="auto-refresh">
                        <input type="checkbox" id="autoRefresh" checked>
                        <label for="autoRefresh">Auto-refresh</label>
                    </div>
                </div>
                <div class="status-indicator status-healthy" id="systemStatus"></div>
                <span id="statusText">System Healthy</span>
            </div>
        </div>

        <div class="dashboard-grid" id="metricsGrid">
            <!-- System Metrics -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">CPU Usage</div>
                        <div class="card-subtitle">Current processor utilization</div>
                    </div>
                </div>
                <div class="metric-value" id="cpuValue">0<span class="metric-unit">%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill progress-low" id="cpuProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Memory Usage</div>
                        <div class="card-subtitle">Current memory utilization</div>
                    </div>
                </div>
                <div class="metric-value" id="memoryValue">0<span class="metric-unit">%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill progress-low" id="memoryProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Response Time</div>
                        <div class="card-subtitle">Average API response time</div>
                    </div>
                </div>
                <div class="metric-value" id="responseTimeValue">0<span class="metric-unit">ms</span></div>
                <div class="progress-bar">
                    <div class="progress-fill progress-low" id="responseTimeProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Cache Hit Rate</div>
                        <div class="card-subtitle">Percentage of cache hits</div>
                    </div>
                </div>
                <div class="metric-value" id="cacheHitValue">0<span class="metric-unit">%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill progress-low" id="cacheHitProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Error Rate</div>
                        <div class="card-subtitle">Percentage of failed operations</div>
                    </div>
                </div>
                <div class="metric-value" id="errorRateValue">0<span class="metric-unit">%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill progress-low" id="errorRateProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Active Sessions</div>
                        <div class="card-subtitle">Currently active user sessions</div>
                    </div>
                </div>
                <div class="metric-value" id="activeSessionsValue">0</div>
            </div>

            <!-- Chart Container -->
            <div class="dashboard-card chart-container">
                <div class="card-header">
                    <div class="card-title">Performance Trends</div>
                    <div class="card-subtitle">Historical performance data</div>
                </div>
                <div class="loading" id="chartLoading">
                    <div class="spinner"></div>
                    Loading chart data...
                </div>
                <canvas class="chart-canvas" id="performanceChart" style="display: none;"></canvas>
            </div>

            <!-- Alerts -->
            <div class="dashboard-card alerts-container">
                <div class="card-header">
                    <div class="card-title">Recent Alerts</div>
                    <div class="card-subtitle">System notifications and warnings</div>
                </div>
                <div id="alertsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading alerts...
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">Recommendations</div>
                    <div class="card-subtitle">Performance optimization suggestions</div>
                </div>
                <div class="recommendations" id="recommendationsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading recommendations...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class PerformanceDashboardUI {
            constructor() {
                this.autoRefreshEnabled = true;
                this.refreshInterval = null;
                this.chart = null;
                
                this.setupEventListeners();
                this.startAutoRefresh();
                this.loadDashboardData();
            }

            setupEventListeners() {
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.loadDashboardData();
                });

                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('autoRefresh').addEventListener('change', (e) => {
                    this.autoRefreshEnabled = e.target.checked;
                    if (this.autoRefreshEnabled) {
                        this.startAutoRefresh();
                    } else {
                        this.stopAutoRefresh();
                    }
                });
            }

            startAutoRefresh() {
                this.stopAutoRefresh();
                if (this.autoRefreshEnabled) {
                    this.refreshInterval = setInterval(() => {
                        this.loadDashboardData();
                    }, 30000); // Refresh every 30 seconds
                }
            }

            stopAutoRefresh() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
            }

            async loadDashboardData() {
                try {
                    const data = await window.electronAPI.getPerformanceDashboard();
                    this.updateMetrics(data.metrics);
                    this.updateChart(data.historicalData);
                    this.updateAlerts(data.alerts);
                    this.updateRecommendations(data.summary.recommendations);
                    this.updateStatus(data.summary);
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                }
            }

            updateMetrics(metrics) {
                // CPU
                const cpuValue = Math.round(metrics.system.cpu);
                document.getElementById('cpuValue').innerHTML = `${cpuValue}<span class="metric-unit">%</span>`;
                this.updateProgressBar('cpuProgress', cpuValue);

                // Memory
                const memoryValue = Math.round(metrics.system.memory);
                document.getElementById('memoryValue').innerHTML = `${memoryValue}<span class="metric-unit">%</span>`;
                this.updateProgressBar('memoryProgress', memoryValue);

                // Response Time
                const responseTime = Math.round(metrics.application.averageResponseTime);
                document.getElementById('responseTimeValue').innerHTML = `${responseTime}<span class="metric-unit">ms</span>`;
                this.updateProgressBar('responseTimeProgress', Math.min(responseTime / 50, 100)); // Scale to 5000ms max

                // Cache Hit Rate
                const cacheHit = Math.round(metrics.application.cacheHitRate);
                document.getElementById('cacheHitValue').innerHTML = `${cacheHit}<span class="metric-unit">%</span>`;
                this.updateProgressBar('cacheHitProgress', cacheHit);

                // Error Rate
                const errorRate = Math.round(metrics.application.errorRate * 10) / 10;
                document.getElementById('errorRateValue').innerHTML = `${errorRate}<span class="metric-unit">%</span>`;
                this.updateProgressBar('errorRateProgress', Math.min(errorRate * 20, 100)); // Scale to 5% max

                // Active Sessions
                document.getElementById('activeSessionsValue').textContent = metrics.sessions?.activeSessions || 0;
            }

            updateProgressBar(id, value) {
                const element = document.getElementById(id);
                element.style.width = `${Math.min(value, 100)}%`;
                
                // Update color based on value
                element.className = 'progress-fill';
                if (value < 50) {
                    element.classList.add('progress-low');
                } else if (value < 80) {
                    element.classList.add('progress-medium');
                } else {
                    element.classList.add('progress-high');
                }
            }

            updateChart(historicalData) {
                // Simple chart implementation - in a real app you'd use Chart.js or similar
                const chartElement = document.getElementById('performanceChart');
                const loadingElement = document.getElementById('chartLoading');
                
                if (historicalData.system.length > 0) {
                    loadingElement.style.display = 'none';
                    chartElement.style.display = 'block';
                    
                    // Basic canvas chart (you would typically use a charting library)
                    this.drawSimpleChart(chartElement, historicalData);
                }
            }

            drawSimpleChart(canvas, data) {
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw CPU line
                ctx.strokeStyle = '#4299e1';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const points = data.system.slice(-50); // Last 50 points
                points.forEach((point, index) => {
                    const x = (index / (points.length - 1)) * canvas.width;
                    const y = canvas.height - (point.cpu / 100) * canvas.height;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
                
                // Add labels
                ctx.fillStyle = '#718096';
                ctx.font = '12px sans-serif';
                ctx.fillText('CPU Usage', 10, 20);
            }

            updateAlerts(alerts) {
                const container = document.getElementById('alertsList');
                
                if (alerts.length === 0) {
                    container.innerHTML = '<div style="color: #718096; text-align: center; padding: 20px;">No active alerts</div>';
                    return;
                }

                container.innerHTML = alerts.map(alert => `
                    <div class="alert-item alert-${alert.severity}">
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-time">${new Date(alert.timestamp).toLocaleString()}</div>
                        </div>
                        ${!alert.acknowledged ? `<button class="btn btn-secondary" onclick="dashboard.acknowledgeAlert('${alert.id}')">Acknowledge</button>` : ''}
                    </div>
                `).join('');
            }

            updateRecommendations(recommendations) {
                const container = document.getElementById('recommendationsList');
                
                if (recommendations.length === 0) {
                    container.innerHTML = '<div style="color: #718096; text-align: center; padding: 20px;">No recommendations at this time</div>';
                    return;
                }

                container.innerHTML = recommendations.map(rec => `
                    <div class="recommendation-item priority-${rec.priority}">
                        <div class="recommendation-title">${rec.title}</div>
                        <div class="recommendation-text">${rec.suggestion}</div>
                    </div>
                `).join('');
            }

            updateStatus(summary) {
                const statusIndicator = document.getElementById('systemStatus');
                const statusText = document.getElementById('statusText');
                
                statusIndicator.className = `status-indicator status-${summary.status}`;
                
                const statusMessages = {
                    healthy: 'System Healthy',
                    warning: 'Performance Issues',
                    critical: 'Critical Issues'
                };
                
                statusText.textContent = statusMessages[summary.status] || 'Unknown Status';
            }

            async acknowledgeAlert(alertId) {
                try {
                    await window.electronAPI.acknowledgeAlert(alertId);
                    this.loadDashboardData(); // Refresh data
                } catch (error) {
                    console.error('Failed to acknowledge alert:', error);
                }
            }

            async exportData() {
                try {
                    const data = await window.electronAPI.exportPerformanceData();
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `performance-data-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } catch (error) {
                    console.error('Failed to export data:', error);
                }
            }
        }

        // Initialize dashboard when page loads
        let dashboard;
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new PerformanceDashboardUI();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (dashboard) {
                dashboard.stopAutoRefresh();
            }
        });
    </script>
</body>
</html>